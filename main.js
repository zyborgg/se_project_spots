!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{const o=t.id+"-error";e.querySelector("#"+o).classList.remove(r.errorClass),t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},n=(e,o,n)=>{o.forEach(r=>{t(e,r,n)});const a=e.querySelector(n.submitButtonSelector);r(o,a,n)},a=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{((e,o)=>{const n=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);r(n,a,o),n.forEach(s=>{s.addEventListener("input",function(){((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{const n=t.id+"-error",a=e.querySelector("#"+n);a.textContent=r,a.classList.add(o.errorClass),t.classList.add(o.inputErrorClass)})(e,r,r.validationMessage,o)})(e,s,o),r(n,a,o)})})})(o,e)})};a(e);const s=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editAvatarInfo({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}addCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}unlikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"d5419a41-0c3e-4747-8e9b-422301ed77fc","Content-Type":"application/json"}}),c=document.querySelector("#edit-profile-modal"),i=c.querySelector(".modal__close"),l=c.querySelector(".modal__form"),d=c.querySelector("#profile-name-input"),u=c.querySelector("#profile-description-input"),m=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),v=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),f=document.querySelector(".modal__submit_type_profile"),y=document.querySelector("#new-post-modal"),S=y.querySelector(".modal__form"),p=y.querySelector(".modal__close"),b=document.querySelector("#card-image-input"),q=document.querySelector("#caption-input"),k=document.querySelector(".modal__submit_type_card"),E=document.querySelector("#preview-modal"),C=E.querySelector(".modal__image"),L=E.querySelector(".modal__caption"),g=E.querySelector(".modal__close"),$=(document.querySelectorAll(".modal"),document.querySelector("#avatar-modal")),j=document.querySelector("#avatar-form"),x=document.querySelector("#profile-avatar-input"),U=document.querySelector(".profile__avatar"),P=document.querySelector(".profile__avatar-button"),A=$.querySelector(".avatar__submit-button"),I=$.querySelector(".modal__close_type_avatar"),D=document.querySelector("#delete-modal"),T=D.querySelector(".modal__delete-button"),B=D.querySelector(".modal__cancel-button"),w=document.querySelector(".modal__close_type_delete");let N,O;const J=document.querySelector("#card-template").content.querySelector(".card"),H=document.querySelector(".cards__list");function z(e,t){const r=J.cloneNode(!0),o=r.querySelector(".card__title"),n=r.querySelector(".card__image");n.src=e.link,n.alt=e.name,o.textContent=e.name;const a=r.querySelector(".card__like-button");return a.addEventListener("click",()=>{a.classList.contains("card__like-button_active")?t.unlikeCard(e._id).then(()=>{a.classList.remove("card__like-button_active")}).catch(e=>console.error(e)):t.likeCard(e._id).then(()=>{a.classList.add("card__like-button_active")}).catch(e=>console.error(e))}),r.querySelector(".card__delete-button").addEventListener("click",()=>{N=r,O=e._id,function(e,t){N=e,O=t._id,G(D)}(r,e),G(D)}),n.addEventListener("click",()=>{C.src=e.link,C.alt=e.name,L.textContent=e.name,G(E)}),e.isLiked?a.classList.add("card__like-button_active"):a.classList.remove("card__like-button_active"),r}function M(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&K(e)}}function F(e){e.target.classList.contains("modal")&&K(e.target)}function G(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",M),e.addEventListener("click",F)}function K(t){t.classList.remove("modal_is-opened"),document.removeEventListener("keydown",M),t.removeEventListener("click",F),t===c?(l.reset(),n(l,[d,u],e)):t===y?(S.reset(),n(S,[b,q],e)):t===$&&(j.reset(),n(j,[x],e))}function Q(e){e?(A.textContent="Saving...",f.textContent="Saving...",k.textContent="Saving..."):(A.textContent="Save",f.textContent="Save",k.textContent="Save")}function R(e){T.textContent=e?"Deleting...":"Delete"}g.addEventListener("click",()=>{K(E)}),T.addEventListener("click",function(e){e.preventDefault(),R(!0),s.removeCard(O).then(()=>{N.remove(),R(!1),K(D)}).catch(e=>{console.error(e),R(!1)})}),w.addEventListener("click",()=>K(D)),B.addEventListener("click",()=>K(D)),m.addEventListener("click",function(){d.value=v.textContent.trim(),u.value=h.textContent.trim(),n(l,[d,u],e),G(c)}),i.addEventListener("click",function(){K(c)}),l.addEventListener("submit",function(e){e.preventDefault(),Q(!0),s.editUserInfo({name:d.value,about:u.value}).then(e=>{v.textContent=d.value.trim(),h.textContent=u.value.trim(),Q(!1),K(c)}).catch(e=>{console.error(e),Q(!1)})}),_.addEventListener("click",function(){G(y)}),p.addEventListener("click",function(){K(y)}),S.addEventListener("submit",function(t){t.preventDefault(),Q(!0),s.addCard({name:q.value,link:b.value}).then(t=>{const r=z(t,s);H.prepend(r),S.reset(),o(k,e),Q(!1),K(y)}).catch(e=>{console.log(e),Q(!1)})}),P.addEventListener("click",function(){G($)}),I.addEventListener("click",function(){K($)}),j.addEventListener("submit",function(e){e.preventDefault(),x.value,Q(!0),s.editAvatarInfo({avatar:x.value}).then(e=>{x.value=e.avatar,U.src=e.avatar,Q(!1),K($)}).catch(e=>{console.error(e),Q(!1)})}),s.getAppInfo().then(([e,t])=>{const r=t.name,o=t.about,n=document.querySelector(".profile__avatar");v.textContent=r,h.textContent=o,n.src=t.avatar,e.forEach(function(e){const t=z(e,s);H.append(t)})}).catch(console.error),a(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU0sS0FBSyxFQUFFK0YsRUFBY0MsTUFDcEIsTUFBTUMsRUFBV0QsRUFBU3pGLEtBQ3BCMkYsRUFBa0JGLEVBQVN4RixNQUMzQjJGLEVBQWdCMUgsU0FBU3BCLGNBQWMsb0JBQzdDd0UsRUFBYzVDLFlBQWNnSCxFQUM1Qm5FLEVBQXFCN0MsWUFBY2lILEVBQ25DQyxFQUFjbkMsSUFBTWdDLEVBQVNsRixPQUU3QmlGLEVBQWEzSCxRQUFRLFNBQVVnSSxHQUM3QixNQUFNeEMsRUFBY0YsRUFBZTBDLEVBQU1qSCxHQUN6Q3NFLEVBQVU0QyxPQUFPekMsRUFDbkIsS0FFRFMsTUFBTUUsUUFBUUMsT0FFakJsRyxFQUFpQjdCLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG59O1xuXG5leHBvcnQgY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBlcnJvck1zZywgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnSUQgPSBpbnB1dEVsLmlkICsgXCItZXJyb3JcIjtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKFwiI1wiICsgZXJyb3JNc2dJRCk7XG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBlcnJvck1zZztcbiAgZXJyb3JNc2dFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5lcnJvckNsYXNzKTtcbiAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuZXhwb3J0IGNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnSUQgPSBpbnB1dEVsLmlkICsgXCItZXJyb3JcIjtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKFwiI1wiICsgZXJyb3JNc2dJRCk7XG4gIGVycm9yTXNnRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuZXJyb3JDbGFzcyk7XG4gIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmV4cG9ydCBjb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZykgPT4ge1xuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsLmRpc2FibGVkID0gZmFsc2U7XG4gICAgYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBkaXNhYmxlQnV0dG9uID0gKGJ1dHRvbkVsLCBjb25maWcpID0+IHtcbiAgYnV0dG9uRWwuZGlzYWJsZWQgPSB0cnVlO1xuICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsLCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0LCBjb25maWcpO1xuICB9KTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbn07XG5cbmV4cG9ydCBjb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBjb25maWcpO1xuICB9KTtcbn07XG5cbmVuYWJsZVZhbGlkYXRpb24oY29uZmlnKTtcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCB7XHJcbiAgZW5hYmxlVmFsaWRhdGlvbixcclxuICBzZXRFdmVudExpc3RlbmVycyxcclxuICBjb25maWcsXHJcbiAgcmVzZXRWYWxpZGF0aW9uLFxyXG4gIGRpc2FibGVCdXR0b24sXHJcbiAgc2hvd0lucHV0RXJyb3IsXHJcbiAgaGlkZUlucHV0RXJyb3IsXHJcbiAgY2hlY2tJbnB1dFZhbGlkaXR5LFxyXG4gIGhhc0ludmFsaWRJbnB1dCxcclxuICB0b2dnbGVCdXR0b25TdGF0ZSxcclxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiZDU0MTlhNDEtMGMzZS00NzQ3LThlOWItNDIyMzAxZWQ3N2ZjXCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59KTtcclxuXHJcbi8vIGVkaXQgcHJvZmlsZSBzdHVmZiAvL1xyXG5jb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XHJcbmNvbnN0IGVkaXRQcm9maWxlQ2xvc2VCdXR0b24gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlXCIpO1xyXG5jb25zdCBlZGl0UHJvZmlsZUZvcm0gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcbmNvbnN0IGVkaXRQcm9maWxlTmFtZUlucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiLFxyXG4pO1xyXG5jb25zdCBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiLFxyXG4pO1xyXG5cclxuLy8gcHJvZmlsZSBlbGVtZW50cyAvL1xyXG5jb25zdCBlZGl0UHJvZmlsZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idXR0b25cIik7XHJcbmNvbnN0IG5ld1Bvc3RCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idXR0b25cIik7XHJcbmNvbnN0IHByb2ZpbGVOYW1lRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XHJcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbkVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcclxuY29uc3QgcHJvZmlsZVN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIubW9kYWxfX3N1Ym1pdF90eXBlX3Byb2ZpbGVcIixcclxuKTtcclxuXHJcbi8vIGVkaXQgZm9ybSBlbGVtZW50cyAvL1xyXG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xyXG5jb25zdCBuZXdDYXJkRm9ybUVsZW1lbnQgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcclxuY29uc3QgbmV3Q2xvc2VCdXR0b24gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2VcIik7XHJcblxyXG4vLyBjYXJkIGZvcm0gZWxlbWVudHMgLy9cclxuY29uc3QgaW1hZ2VJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1pbWFnZS1pbnB1dFwiKTtcclxuY29uc3QgY2FwdGlvbklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXB0aW9uLWlucHV0XCIpO1xyXG5jb25zdCBjYXJkU3VibWl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0X3R5cGVfY2FyZFwiKTtcclxuXHJcbi8vIHByZXZpZXcgaW1hZ2UgcG9wdXAgZWxlbWVudHMgLy9cclxuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xyXG5jb25zdCBwcmV2aWV3TW9kYWxJbWFnZUVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG5jb25zdCBwcmV2aWV3TW9kYWxDYXB0aW9uID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XHJcbmNvbnN0IHByZXZpZXdNb2RhbENsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlXCIpO1xyXG5jb25zdCBhbGxNb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xyXG5cclxuLy8gYXZhdGFyIGVsZW1lbnRzIC8vXHJcbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbW9kYWxcIik7XHJcbmNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1mb3JtXCIpO1xyXG5jb25zdCBhdmF0YXJJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hdmF0YXItaW5wdXRcIik7XHJcbmNvbnN0IGF2YXRhckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcbmNvbnN0IGF2YXRhckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ1dHRvblwiKTtcclxuY29uc3QgYXZhdGFyU3VibWl0QnV0dG9uID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5hdmF0YXJfX3N1Ym1pdC1idXR0b25cIik7XHJcbmNvbnN0IGF2YXRhckNsb3NlQnV0dG9uID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcclxuICBcIi5tb2RhbF9fY2xvc2VfdHlwZV9hdmF0YXJcIixcclxuKTtcclxuXHJcbi8vIGRlbGV0ZSBmb3JtIGVsZW1lbnRzIC8vXHJcbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtbW9kYWxcIik7XHJcbmNvbnN0IGRlbGV0ZUNvbmZpcm1CdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19kZWxldGUtYnV0dG9uXCIpO1xyXG5jb25zdCBjYXJkY2FuY2VsID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FuY2VsLWJ1dHRvblwiKTtcclxuY29uc3QgZGVsZXRlTW9kYWxDbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlX3R5cGVfZGVsZXRlXCIpO1xyXG5sZXQgc2VsZWN0ZWRDYXJkO1xyXG5sZXQgc2VsZWN0ZWRDYXJkSWQ7XHJcblxyXG4vLyBjYXJkIHJlbGF0ZWQgZWxlbWVudHMgLy9cclxuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnRcclxuICAucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpXHJcbiAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpO1xyXG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xyXG5cclxucHJldmlld01vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YSkge1xyXG4gIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xyXG4gIHNlbGVjdGVkQ2FyZElkID0gZGF0YS5faWQ7XHJcbiAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGhhbmRsZURlbGV0ZUNvbmZpcm1hdGlvbih0cnVlKTtcclxuXHJcbiAgYXBpXHJcbiAgICAucmVtb3ZlQ2FyZChzZWxlY3RlZENhcmRJZClcclxuICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xyXG4gICAgICBoYW5kbGVEZWxldGVDb25maXJtYXRpb24oZmFsc2UpO1xyXG4gICAgICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgIGhhbmRsZURlbGV0ZUNvbmZpcm1hdGlvbihmYWxzZSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSwgYXBpKSB7XHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gIGNvbnN0IGNhcmRUaXRsZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcclxuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcblxyXG4gIGNhcmRJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcclxuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XHJcbiAgY2FyZFRpdGxlRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcblxyXG4gIGNvbnN0IGNhcmRMaWtlQnV0dG9uRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xyXG4gIGNhcmRMaWtlQnV0dG9uRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIGNvbnN0IGlzTGlrZWQgPSBjYXJkTGlrZUJ1dHRvbkVsLmNsYXNzTGlzdC5jb250YWlucyhcclxuICAgICAgXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIixcclxuICAgICk7XHJcblxyXG4gICAgaWYgKGlzTGlrZWQpIHtcclxuICAgICAgYXBpXHJcbiAgICAgICAgLnVubGlrZUNhcmQoZGF0YS5faWQpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgY2FyZExpa2VCdXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBhcGlcclxuICAgICAgICAubGlrZUNhcmQoZGF0YS5faWQpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgY2FyZExpa2VCdXR0b25FbC5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKTtcclxuICBkZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xyXG4gICAgc2VsZWN0ZWRDYXJkSWQgPSBkYXRhLl9pZDtcclxuICAgIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEpO1xyXG4gICAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcclxuICB9KTtcclxuXHJcbiAgY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIHByZXZpZXdNb2RhbEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xyXG4gICAgcHJldmlld01vZGFsSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XHJcbiAgICBwcmV2aWV3TW9kYWxDYXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XHJcbiAgfSk7XHJcblxyXG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcclxuICAgIGNhcmRMaWtlQnV0dG9uRWwuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICB9IGVsc2Uge1xyXG4gICAgY2FyZExpa2VCdXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gIH1cclxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbn1cclxuXHJcbmRlbGV0ZUNvbmZpcm1CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XHJcbmRlbGV0ZU1vZGFsQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpKTtcclxuY2FyZGNhbmNlbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChkZWxldGVNb2RhbCkpO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlRXNjYXBlS2V5KGV2dCkge1xyXG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICBjb25zdCBvcGVuTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX2lzLW9wZW5lZFwiKTtcclxuICAgIGlmIChvcGVuTW9kYWwpIHtcclxuICAgICAgY2xvc2VNb2RhbChvcGVuTW9kYWwpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlT3ZlcmxheUNsaWNrKGV2ZW50KSB7XHJcbiAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbFwiKSkge1xyXG4gICAgY2xvc2VNb2RhbChldmVudC50YXJnZXQpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XHJcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX2lzLW9wZW5lZFwiKTtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGVLZXkpO1xyXG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVPdmVybGF5Q2xpY2spO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XHJcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX2lzLW9wZW5lZFwiKTtcclxuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGVLZXkpO1xyXG4gIG1vZGFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVPdmVybGF5Q2xpY2spO1xyXG4gIGlmIChtb2RhbCA9PT0gZWRpdFByb2ZpbGVNb2RhbCkge1xyXG4gICAgZWRpdFByb2ZpbGVGb3JtLnJlc2V0KCk7XHJcbiAgICByZXNldFZhbGlkYXRpb24oXHJcbiAgICAgIGVkaXRQcm9maWxlRm9ybSxcclxuICAgICAgW2VkaXRQcm9maWxlTmFtZUlucHV0LCBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXRdLFxyXG4gICAgICBjb25maWcsXHJcbiAgICApO1xyXG4gIH0gZWxzZSBpZiAobW9kYWwgPT09IG5ld1Bvc3RNb2RhbCkge1xyXG4gICAgbmV3Q2FyZEZvcm1FbGVtZW50LnJlc2V0KCk7XHJcbiAgICByZXNldFZhbGlkYXRpb24obmV3Q2FyZEZvcm1FbGVtZW50LCBbaW1hZ2VJbnB1dCwgY2FwdGlvbklucHV0XSwgY29uZmlnKTtcclxuICB9IGVsc2UgaWYgKG1vZGFsID09PSBhdmF0YXJNb2RhbCkge1xyXG4gICAgYXZhdGFyRm9ybS5yZXNldCgpO1xyXG4gICAgcmVzZXRWYWxpZGF0aW9uKGF2YXRhckZvcm0sIFthdmF0YXJJbnB1dF0sIGNvbmZpZyk7XHJcbiAgfVxyXG59XHJcblxyXG5lZGl0UHJvZmlsZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gIGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudC50cmltKCk7XHJcbiAgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQudHJpbSgpO1xyXG4gIHJlc2V0VmFsaWRhdGlvbihcclxuICAgIGVkaXRQcm9maWxlRm9ybSxcclxuICAgIFtlZGl0UHJvZmlsZU5hbWVJbnB1dCwgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0XSxcclxuICAgIGNvbmZpZyxcclxuICApO1xyXG4gIG9wZW5Nb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcclxufSk7XHJcblxyXG5lZGl0UHJvZmlsZUNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcclxufSk7XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVFZGl0UHJvZmlsZVN1Ym1pdChldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICByZW5kZXJCdXR0b25Mb2FkaW5nKHRydWUpO1xyXG4gIGFwaVxyXG4gICAgLmVkaXRVc2VySW5mbyh7XHJcbiAgICAgIG5hbWU6IGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlLFxyXG4gICAgICBhYm91dDogZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxyXG4gICAgfSlcclxuICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZS50cmltKCk7XHJcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID1cclxuICAgICAgICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUudHJpbSgpO1xyXG4gICAgICByZW5kZXJCdXR0b25Mb2FkaW5nKGZhbHNlKTtcclxuICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgIHJlbmRlckJ1dHRvbkxvYWRpbmcoZmFsc2UpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdChldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBhdmF0YXJVcmwgPSBhdmF0YXJJbnB1dC52YWx1ZTtcclxuICByZW5kZXJCdXR0b25Mb2FkaW5nKHRydWUpO1xyXG4gIGFwaVxyXG4gICAgLmVkaXRBdmF0YXJJbmZvKHtcclxuICAgICAgYXZhdGFyOiBhdmF0YXJJbnB1dC52YWx1ZSxcclxuICAgIH0pXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICBhdmF0YXJJbnB1dC52YWx1ZSA9IGRhdGEuYXZhdGFyO1xyXG4gICAgICBhdmF0YXJJbWFnZS5zcmMgPSBkYXRhLmF2YXRhcjtcclxuICAgICAgcmVuZGVyQnV0dG9uTG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgcmVuZGVyQnV0dG9uTG9hZGluZyhmYWxzZSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVuZGVyQnV0dG9uTG9hZGluZyhpc0xvYWRpbmcpIHtcclxuICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICBhdmF0YXJTdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xyXG4gICAgcHJvZmlsZVN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XHJcbiAgICBjYXJkU3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcclxuICB9IGVsc2Uge1xyXG4gICAgYXZhdGFyU3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XHJcbiAgICBwcm9maWxlU3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XHJcbiAgICBjYXJkU3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDb25maXJtYXRpb24oaXNEZWxldGluZykge1xyXG4gIGlmIChpc0RlbGV0aW5nKSB7XHJcbiAgICBkZWxldGVDb25maXJtQnV0dG9uLnRleHRDb250ZW50ID0gXCJEZWxldGluZy4uLlwiO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBkZWxldGVDb25maXJtQnV0dG9uLnRleHRDb250ZW50ID0gXCJEZWxldGVcIjtcclxuICB9XHJcbn1cclxuXHJcbmVkaXRQcm9maWxlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRQcm9maWxlU3VibWl0KTtcclxuXHJcbm5ld1Bvc3RCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICBvcGVuTW9kYWwobmV3UG9zdE1vZGFsKTtcclxufSk7XHJcblxyXG5uZXdDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcclxufSk7XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIHJlbmRlckJ1dHRvbkxvYWRpbmcodHJ1ZSk7XHJcbiAgYXBpXHJcbiAgICAuYWRkQ2FyZCh7XHJcbiAgICAgIG5hbWU6IGNhcHRpb25JbnB1dC52YWx1ZSxcclxuICAgICAgbGluazogaW1hZ2VJbnB1dC52YWx1ZSxcclxuICAgIH0pXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGRhdGEsIGFwaSk7XHJcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcclxuICAgICAgbmV3Q2FyZEZvcm1FbGVtZW50LnJlc2V0KCk7XHJcbiAgICAgIGRpc2FibGVCdXR0b24oY2FyZFN1Ym1pdEJ1dHRvbiwgY29uZmlnKTtcclxuICAgICAgcmVuZGVyQnV0dG9uTG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICByZW5kZXJCdXR0b25Mb2FkaW5nKGZhbHNlKTtcclxuICAgIH0pO1xyXG59XHJcbm5ld0NhcmRGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRTdWJtaXQpO1xyXG5cclxuYXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcclxufSk7XHJcblxyXG5hdmF0YXJDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xyXG59KTtcclxuXHJcbmF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJTdWJtaXQpO1xyXG5cclxuYXBpXHJcbiAgLmdldEFwcEluZm8oKVxyXG4gIC50aGVuKChbaW5pdGlhbENhcmRzLCB1c2VySW5mb10pID0+IHtcclxuICAgIGNvbnN0IHVzZXJOYW1lID0gdXNlckluZm8ubmFtZTtcclxuICAgIGNvbnN0IHVzZXJEZXNjcmlwdGlvbiA9IHVzZXJJbmZvLmFib3V0O1xyXG4gICAgY29uc3QgcHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xyXG4gICAgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IHVzZXJOYW1lO1xyXG4gICAgcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQgPSB1c2VyRGVzY3JpcHRpb247XHJcbiAgICBwcm9maWxlQXZhdGFyLnNyYyA9IHVzZXJJbmZvLmF2YXRhcjtcclxuXHJcbiAgICBpbml0aWFsQ2FyZHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGl0ZW0sIGFwaSk7XHJcbiAgICAgIGNhcmRzTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xyXG4gICAgfSk7XHJcbiAgfSlcclxuICAuY2F0Y2goY29uc29sZS5lcnJvcik7XHJcblxyXG5lbmFibGVWYWxpZGF0aW9uKGNvbmZpZyk7XHJcbiIsImNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICBnZXRBcHBJbmZvKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcclxuICB9XHJcblxyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgYWJvdXQsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZWRpdEF2YXRhckluZm8oeyBhdmF0YXIgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBhdmF0YXIsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBsaW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlbW92ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsaWtlQ2FyZChjYXJkSWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICB1bmxpa2VDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEFwaTtcclxuIl0sIm5hbWVzIjpbImNvbmZpZyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWwiLCJpbnB1dEVsIiwiZXJyb3JNc2dJRCIsImlkIiwicXVlcnlTZWxlY3RvciIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWwiLCJzb21lIiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZUJ1dHRvbiIsImRpc2FibGVkIiwiYWRkIiwicmVzZXRWYWxpZGF0aW9uIiwiZm9yRWFjaCIsImJ1dHRvbkVsZW1lbnQiLCJlbmFibGVWYWxpZGF0aW9uIiwiQXJyYXkiLCJmcm9tIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJhZGRFdmVudExpc3RlbmVyIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1zZyIsImVycm9yTXNnRWwiLCJ0ZXh0Q29udGVudCIsInZhbGlkYXRpb25NZXNzYWdlIiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsImVkaXRVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdEF2YXRhckluZm8iLCJhdmF0YXIiLCJhZGRDYXJkIiwibGluayIsInJlbW92ZUNhcmQiLCJjYXJkSWQiLCJsaWtlQ2FyZCIsInVubGlrZUNhcmQiLCJhdXRob3JpemF0aW9uIiwiZWRpdFByb2ZpbGVNb2RhbCIsImVkaXRQcm9maWxlQ2xvc2VCdXR0b24iLCJlZGl0UHJvZmlsZUZvcm0iLCJlZGl0UHJvZmlsZU5hbWVJbnB1dCIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImVkaXRQcm9maWxlQnV0dG9uIiwibmV3UG9zdEJ1dHRvbiIsInByb2ZpbGVOYW1lRWwiLCJwcm9maWxlRGVzY3JpcHRpb25FbCIsInByb2ZpbGVTdWJtaXRCdXR0b24iLCJuZXdQb3N0TW9kYWwiLCJuZXdDYXJkRm9ybUVsZW1lbnQiLCJuZXdDbG9zZUJ1dHRvbiIsImltYWdlSW5wdXQiLCJjYXB0aW9uSW5wdXQiLCJjYXJkU3VibWl0QnV0dG9uIiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsSW1hZ2VFbCIsInByZXZpZXdNb2RhbENhcHRpb24iLCJwcmV2aWV3TW9kYWxDbG9zZUJ0biIsImF2YXRhck1vZGFsIiwiYXZhdGFyRm9ybSIsImF2YXRhcklucHV0IiwiYXZhdGFySW1hZ2UiLCJhdmF0YXJCdXR0b24iLCJhdmF0YXJTdWJtaXRCdXR0b24iLCJhdmF0YXJDbG9zZUJ1dHRvbiIsImRlbGV0ZU1vZGFsIiwiZGVsZXRlQ29uZmlybUJ1dHRvbiIsImNhcmRjYW5jZWwiLCJkZWxldGVNb2RhbENsb3NlIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50IiwiY2FyZHNMaXN0IiwiZ2V0Q2FyZEVsZW1lbnQiLCJkYXRhIiwiY2FyZEVsZW1lbnQiLCJjbG9uZU5vZGUiLCJjYXJkVGl0bGVFbCIsImNhcmRJbWFnZUVsIiwic3JjIiwiYWx0IiwiY2FyZExpa2VCdXR0b25FbCIsImNvbnRhaW5zIiwiX2lkIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJvcGVuTW9kYWwiLCJoYW5kbGVEZWxldGVDYXJkIiwiaXNMaWtlZCIsImhhbmRsZUVzY2FwZUtleSIsImV2dCIsImtleSIsImNsb3NlTW9kYWwiLCJoYW5kbGVPdmVybGF5Q2xpY2siLCJldmVudCIsInRhcmdldCIsIm1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInJlc2V0IiwicmVuZGVyQnV0dG9uTG9hZGluZyIsImlzTG9hZGluZyIsImhhbmRsZURlbGV0ZUNvbmZpcm1hdGlvbiIsImlzRGVsZXRpbmciLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlIiwidHJpbSIsInByZXBlbmQiLCJsb2ciLCJpbml0aWFsQ2FyZHMiLCJ1c2VySW5mbyIsInVzZXJOYW1lIiwidXNlckRlc2NyaXB0aW9uIiwicHJvZmlsZUF2YXRhciIsIml0ZW0iLCJhcHBlbmQiXSwic291cmNlUm9vdCI6IiJ9